name: Build Windows Tracker EXE

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller requests
    
    - name: Build EXE
      run: |
        cd tracker\gui
        python -m pyinstaller --onefile --windowed --name "PokeAchieveTracker_v1.4" tracker_gui.py
    
    - name: Prepare release files
      run: |
        mkdir release
        copy tracker\gui\dist\PokeAchieveTracker_v1.4.exe release\
        xcopy /E /I tracker\achievements release\achievements\
        echo # PokeAchieve Tracker v1.4 > release\README.txt
        echo ## Installation >> release\README.txt
        echo 1. Run PokeAchieveTracker_v1.4.exe >> release\README.txt
        echo 2. Enter your API key from https://pokeachieve.com/dashboard.html >> release\README.txt
    
    - name: Upload to Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          release/PokeAchieveTracker_v1.4.exe
          release/achievements/**
        name: PokeAchieve Tracker v1.4
        body: |
          ## What's New in v1.4
          - Story achievements (HM detection, Pokedex obtained, etc.)
          - All 10 Pokemon games supported (Red/Blue/Gold/Silver/Crystal/Ruby/Sapphire/Emerald/FireRed/LeafGreen)
          - 361 total achievements
          - API key authentication for cloud sync
          - HM item detection in bag
          
          ## Files
          - `PokeAchieveTracker_v1.4.exe` - The tracker application
          - `achievements/` - Achievement definitions for all games
          
          ## Installation
          1. Download `PokeAchieveTracker_v1.4.exe`
          2. Run it (no install needed)
          3. Get your API key from https://pokeachieve.com/dashboard.html
          4. Start tracking your Pokemon journey!
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
