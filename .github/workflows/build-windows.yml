name: Build Windows Tracker EXE

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller requests
    
    - name: Build EXE with bundled achievements
      run: |
        cd gui
        python -m pyinstaller --onefile --windowed --name "PokeAchieveTracker_v1.4" --add-data "../achievements;achievements" tracker_gui.py
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: gui/dist/PokeAchieveTracker_v1.4.exe
        name: PokeAchieve Tracker v1.4
        body: |
          ## PokeAchieve Tracker v1.4
          
          **Single EXE with all achievements bundled!**
          
          ### What's New
          - Story achievements (HM detection, Pokedex obtained, etc.)
          - All 10 Pokemon games supported (Red/Blue/Gold/Silver/Crystal/Ruby/Sapphire/Emerald/FireRed/LeafGreen)
          - 361 total achievements
          - API key authentication for cloud sync
          - HM item detection in bag
          
          ### Installation
          1. Download `PokeAchieveTracker_v1.4.exe`
          2. Run it (no install needed, all achievements bundled)
          3. Get your API key from https://pokeachieve.com/dashboard.html
          4. Start tracking your Pokemon journey!
          
          ### Supported Games
          - Pokemon Red, Blue (Gen 1)
          - Pokemon Gold, Silver, Crystal (Gen 2)
          - Pokemon Ruby, Sapphire, Emerald (Gen 3)
          - Pokemon FireRed, LeafGreen (Gen 3 remakes)
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
